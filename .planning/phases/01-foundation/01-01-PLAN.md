---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - SKILL.md
autonomous: true
requirements:
  - TS-9
  - TS-10
  - TS-5
  - TS-7
  - TS-8
  - D-4

must_haves:
  truths:
    - "SKILL.md references only Claude Code -- zero mentions of Codex, OpenCode, or Pi"
    - "SKILL.md claims ALL non-chat tasks with no duration threshold"
    - "The tmux send-keys template includes --model flag mapping opus to claude-opus-4-6 and sonnet to claude-sonnet-4-6"
    - "The task directory layout (prompt, pid, output.log, manifest.json, done, exit_code) is documented as a specification"
    - "File-based prompt delivery via $(cat $TASK_TMPDIR/prompt) is preserved"
    - "Secure temp directory pattern (mktemp -d + chmod 700) is preserved"
  artifacts:
    - path: "SKILL.md"
      provides: "Single-agent, model-aware orchestrator skill document"
      contains: "claude -p --model"
  key_links:
    - from: "SKILL.md"
      to: "Claude Code CLI"
      via: "tmux send-keys template with --model flag"
      pattern: "claude -p --model"
    - from: "SKILL.md"
      to: "Task directory schema"
      via: "specification section documenting canonical layout"
      pattern: "prompt.*pid.*output\\.log.*manifest\\.json.*done.*exit_code"
---

<objective>
Rewrite SKILL.md as a single-agent (Claude Code only), model-aware, aggressively-scoped skill document with a task directory schema specification.

Purpose: Eliminate all multi-agent dead code from the orchestrator interface document, add model routing via the --model flag, claim ALL non-chat tasks unconditionally, and document the canonical task directory layout that all subsequent phases build on.

Output: A completely rewritten SKILL.md that passes all Phase 1 success criteria for TS-9, TS-10, TS-5, TS-7, TS-8, and D-4.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite SKILL.md -- single-agent, model-aware, aggressive scope</name>
  <files>SKILL.md</files>
  <action>
Rewrite SKILL.md from scratch as a single-agent Claude Code skill document. The new document must follow this exact structure (derived from research "Recommended SKILL.md Structure"):

**Frontmatter** -- Update YAML frontmatter:
- `name: resilient-coding-agent` (keep)
- `description:` rewrite to reference Claude Code only, no mention of other agents
- `metadata.openclaw.requires.bins: [tmux, claude]` -- replace `anyBins: [codex, claude, opencode, pi]` with `bins: [tmux, claude]`
- Keep the emoji

**Introduction** -- Single paragraph: This skill runs Claude Code sessions in tmux for fire-and-forget execution with crash recovery. No mention of Codex, OpenCode, Pi, or "multiple agents."

**Placeholders** -- Document three placeholders:
- `<task-name>`: sanitized task identifier, must match `[a-z0-9-]`
- `<project-dir>`: valid existing directory
- `<model>`: Brain passes `opus` or `sonnet`; maps to full model names in the send-keys command

**Temp Directory and Prompt Safety** -- Preserve existing patterns exactly:
- `mktemp -d` + `chmod 700` for secure temp directory (TS-7)
- Write prompt via orchestrator write tool, reference with `"$(cat $TASK_TMPDIR/prompt)"` (TS-8)
- Keep the security notes about sensitive output and file permissions

**When to Use This** -- Aggressive scope claim (TS-10):
```
Use this skill for ALL tasks that are not pure conversational chat. This includes:
- Coding, debugging, refactoring, and architecture work
- File exploration, search, and analysis
- Test writing and test debugging
- Documentation generation
- Code review and security analysis
- Any reasoning or investigation task

You are NOT a coding agent. Do not attempt to do coding work directly.
Delegate ALL substantive work through this skill, regardless of expected duration.
```
No duration threshold. No "quick tasks under 5 minutes" exception.

**Task Directory Schema** -- Document the canonical layout as a specification (D-4):
```
$TMPDIR/                         # mktemp -d, chmod 700
  prompt                         # Task instructions (existing, Phase 1)
  pid                            # Claude Code child PID (Phase 2)
  output.log                     # Continuous output capture (Phase 2)
  manifest.json                  # Structured task state JSON (Phase 3)
  done                           # Completion marker (Phase 2)
  exit_code                      # Process exit code (Phase 2)
```
For each file: describe purpose, who writes it, who reads it, and which phase creates it. Clearly distinguish "exists now" (prompt) from "will be created in Phase N."

**Start a Task** -- Single Claude Code section only (TS-9, TS-5):
- Remove ALL Codex, OpenCode, and Pi sections entirely
- The canonical launch command template:
```bash
TMPDIR=$(mktemp -d) && chmod 700 "$TMPDIR"
# Write prompt via orchestrator write tool (no shell) to $TMPDIR/prompt
tmux new-session -d -s claude-<task-name> -e "TASK_TMPDIR=$TMPDIR"
tmux send-keys -t claude-<task-name> \
  'cd <project-dir> && claude -p --model <model-name> "$(cat $TASK_TMPDIR/prompt)" && echo "__TASK_DONE__"' Enter
```
- Include a model mapping table: Brain sends `opus` -> use `claude-opus-4-6`; Brain sends `sonnet` -> use `claude-sonnet-4-6`
- Keep `&& echo "__TASK_DONE__"` (Phase 2 replaces this with done-file; preserve for now)
- CRITICAL: Both `-p` and `--model` flags must be present. `-p` for non-interactive mode, `--model` for model selection.

**Completion Notification** -- Keep the OpenClaw system event pattern, but only with Claude Code examples (no Codex/OpenCode/Pi).

**Monitor Progress** -- Simplify to Claude Code only:
- `tmux has-session -t claude-<task-name>` to check session existence
- `tmux capture-pane -t claude-<task-name> -p -S -200` for recent output
- Remove all agent-prefix examples except `claude-`

**Health Monitoring** -- Reference `scripts/monitor.sh`. Describe the behavior: periodic checks, crash detection, auto-resume via `claude -c`. Remove all multi-agent language.

**Recovery After Interruption** -- Claude Code only:
- Replace `claude --resume` with `claude -c` (continue most recent session)
- Remove Codex, OpenCode, Pi recovery sections entirely
- Note: `claude -c` continues the most recent conversation in the working directory

**Cleanup** -- Update to Claude Code only:
- `tmux kill-session -t claude-<task-name>`
- `tmux list-sessions 2>/dev/null | grep -E '^claude-'`

**Naming Convention** -- Update: sessions use `claude-<task-name>` pattern only. Remove `codex-`, `opencode-`, `pi-` examples.

**Checklist** -- Simplified for single-agent:
1. Create secure temp directory
2. Write prompt to file
3. Launch Claude Code in tmux with correct model
4. Notify user: task content, session name, model used
5. Monitor via scripts/monitor.sh or manual tmux capture-pane

**Limitations** -- Keep tmux reboot limitation. Update resume reference to `claude -c`. Remove multi-agent language.

**Prerequisites** -- Rewrite to remove multi-agent references. This skill requires tmux and the Claude Code CLI (`claude`). No mention of "Codex, Claude Code, etc." or other agent CLIs.

IMPORTANT CONSTRAINTS:
- Zero mentions of "Codex", "OpenCode", "Pi", "opencode", "pi", "codex" anywhere in the final file (TS-9)
- Use full model names `claude-opus-4-6` and `claude-sonnet-4-6` in templates, not aliases (per research decision for determinism)
- Preserve the `__TASK_DONE__` marker in the send-keys command (Phase 2 replaces it)
- Do NOT implement files that do not exist yet (pid, output.log, manifest.json, done, exit_code) -- only document them as specification
  </action>
  <verify>
Run these checks:
1. `grep -iE 'codex|opencode|(?<!\w)pi(?!\w)' SKILL.md` should return zero results (no dead agent references). Note: "pi" match should be word-bounded to avoid matching "pipe" etc. Use: `grep -iw 'codex\|opencode\|pi' SKILL.md`
2. `grep -c 'claude -p --model' SKILL.md` should return at least 1 (model routing in send-keys template)
3. `grep -c 'ALL' SKILL.md` in the "When to Use" section should confirm aggressive scope claim
4. `grep -c 'manifest.json' SKILL.md` should return at least 1 (task directory schema documented)
5. `grep 'anyBins' SKILL.md` should return zero results (frontmatter updated)
6. `grep 'bins:' SKILL.md` should show `[tmux, claude]`
7. `grep '__TASK_DONE__' SKILL.md` should return at least 1 (marker preserved)
  </verify>
  <done>
SKILL.md is a complete, single-agent, model-aware skill document where:
- Zero references to Codex, OpenCode, or Pi exist anywhere in the file
- "When to Use" claims ALL non-chat tasks with no duration threshold
- The tmux send-keys template includes `--model` flag with mapping from opus/sonnet to full model names
- Task directory schema is documented as a specification with phase ownership
- File-based prompt delivery and secure temp directory patterns are preserved
- Frontmatter declares `bins: [tmux, claude]` (not anyBins with dead agents)
- `__TASK_DONE__` marker is preserved in the launch template
- Resume command uses `claude -c` (not deprecated `claude --resume`)
  </done>
</task>

</tasks>

<verification>
After task completion, verify all Phase 1 SKILL.md criteria:

1. **TS-9 (Claude Code only):** `grep -iwE 'codex|opencode|pi' SKILL.md` returns nothing
2. **TS-10 (Aggressive scope):** "When to Use" section contains "ALL" and no "5 minutes" threshold
3. **TS-5 (Model routing):** Template contains `claude -p --model` with model name mapping
4. **TS-7 (Secure temp):** `mktemp -d` and `chmod 700` patterns present
5. **TS-8 (File-based prompt):** `$(cat $TASK_TMPDIR/prompt)` pattern present
6. **D-4 (Directory schema):** Task directory layout section documents all 6 files with phase ownership
</verification>

<success_criteria>
- SKILL.md contains zero references to Codex, OpenCode, or Pi
- SKILL.md "When to Use" claims ALL non-chat tasks unconditionally
- tmux send-keys template includes `--model claude-opus-4-6` / `--model claude-sonnet-4-6` mapping
- Task directory schema specification documents prompt, pid, output.log, manifest.json, done, exit_code
- Existing security patterns (mktemp, file-based prompt) preserved
- Frontmatter updated to `bins: [tmux, claude]`
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
