---
phase: 05-brain-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - SKILL.md
autonomous: true
requirements:
  - D-2

must_haves:
  truths:
    - "SKILL.md contains no duration-based conditional gating the use of the monitor (no 'For long-running tasks' or equivalent phrase in the Health Monitoring or launch sections)"
    - "Checklist step 9 makes monitor.sh launch mandatory with no 'or' alternative for manual polling"
    - "Monitor Progress section explicitly states that output.log and manifest.json persist after tmux kill-session"
  artifacts:
    - path: "SKILL.md"
      provides: "D-2-compliant policy: all tasks via tmux + monitor, result retrieval documented as post-cleanup safe"
      contains: "Use the active monitor script (`scripts/monitor.sh`) for every task"
  key_links:
    - from: "SKILL.md line 180 (Health Monitoring section)"
      to: "D-2 requirement"
      via: "removal of 'For long-running tasks' conditional"
      pattern: "grep -n 'long-running' SKILL.md returns no match in the Health Monitoring section"
    - from: "SKILL.md Checklist step 9"
      to: "D-2 requirement"
      via: "mandatory monitor launch (no 'or' alternative)"
      pattern: "grep -n 'Monitor via' SKILL.md contains no 'or tail' alternative"
---

<objective>
Make SKILL.md fully D-2 compliant by removing the one duration-based conditional that implies the monitor is optional, updating the checklist to make monitor launch mandatory, and documenting that result files persist after tmux session cleanup.

Purpose: D-2 requires "no fast path -- every task gets tmux session + monitor regardless of expected duration." One sentence in SKILL.md (line 180) violates this by opening with "For long-running tasks." Two additional minor edits strengthen compliance: the checklist step 9 currently allows skipping the monitor ("or tail -n 50"), and the Monitor Progress section does not tell the Brain that $TMPDIR files survive session cleanup (success criterion 2).

Output: Modified SKILL.md with three targeted edits -- all pure text changes, no code changes.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/05-brain-integration/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply three targeted D-2 compliance edits to SKILL.md</name>
  <files>SKILL.md</files>
  <action>
Make exactly three text edits to SKILL.md. Do not modify any other lines.

**Edit 1 -- Remove duration-based conditional (line 180, D-2 violation):**

Find this exact sentence at the start of the Health Monitoring section:
```
For long-running tasks, use the active monitor script (`scripts/monitor.sh`) instead of checking on demand. The monitor runs continuously with configurable intervals and handles its own timing -- no cron or external scheduler needed.
```

Replace with:
```
Use the active monitor script (`scripts/monitor.sh`) for every task. The monitor runs continuously with configurable intervals and handles its own timing -- no cron or external scheduler needed.
```

Rationale: "For long-running tasks" implies the monitor is optional for short tasks. D-2 says every task gets the monitor. The replacement sentence removes the conditional and explicitly states "every task."

**Edit 2 -- Make monitor launch mandatory in Checklist (line 263):**

Find this exact checklist line:
```
9. Monitor via `scripts/monitor.sh` (done-file/PID detection) or `tail -n 50 $TMPDIR/output.log`
```

Replace with:
```
9. Launch monitor: `scripts/monitor.sh` (handles done-file detection, PID liveness, and staleness -- mandatory for every task)
```

Rationale: The "or" alternative lets the Brain skip monitor.sh and just tail the log. D-2 requires the monitor to be launched for every task. Removing the "or" closes this loophole. The parenthetical summarizes what the monitor does so the Brain understands why it is mandatory.

**Edit 3 -- Document $TMPDIR persistence in Monitor Progress section (success criterion 2):**

Find this paragraph in the Monitor Progress section (immediately after the tail command code block):
```
For ad-hoc checks or manual debugging, tmux capture-pane is still available:
```

Insert the following sentence BEFORE that line (as a new paragraph after the closing triple-backtick of the tail code block):

```
Both `output.log` and `manifest.json` persist after the tmux session is killed -- `$TMPDIR` is created outside the session and is not deleted by monitor cleanup or `tmux kill-session`. This means result retrieval via `tail -n 50 $TMPDIR/output.log` or `jq -r '.output_tail' $TMPDIR/manifest.json` works even after the session is gone.
```

Rationale: Success criterion 2 requires the Brain to know it can retrieve results after session cleanup. Without this sentence, the Brain may assume the output is gone when the session dies.
  </action>
  <verify>
Run each of the following greps after editing. All assertions must hold:

```bash
# 1. D-2 violation is gone
grep -n "long-running" SKILL.md
# Expected: no match (or only matches outside the Health Monitoring section, if any)

# 2. Replacement sentence is present
grep -n "for every task" SKILL.md
# Expected: matches line in Health Monitoring section

# 3. Checklist step 9 no longer has the "or" alternative
grep -n "Monitor via.*or" SKILL.md
# Expected: no match

# 4. Persistence documentation is present
grep -n "persist after the tmux session is killed" SKILL.md
# Expected: 1 match

# 5. No unintended structural damage -- section headers still intact
grep -n "^## " SKILL.md
# Expected: same section headers as before (Health Monitoring, Monitor Progress, etc.)
```
  </verify>
  <done>
- Line 180 reads "Use the active monitor script (`scripts/monitor.sh`) for every task." (no "For long-running tasks" conditional)
- Checklist step 9 reads "Launch monitor: `scripts/monitor.sh` ..." with no "or tail" alternative
- Monitor Progress section contains a paragraph stating output.log and manifest.json persist after tmux kill-session
- All five grep assertions above pass
  </done>
</task>

</tasks>

<verification>
After execution, confirm D-2 compliance via static analysis:

```bash
# Full duration-based routing audit -- must return no hits in launch/monitor sections
grep -n "long-running\|fast path\|short task" SKILL.md

# Confirm "every task" policy is stated
grep -n "every task" SKILL.md
# Expected: at least 2 hits (line ~52 "regardless of expected duration" context + line 180 fix)

# Confirm monitor is mandatory in checklist
grep -n "^9\." SKILL.md
# Expected: "Launch monitor: scripts/monitor.sh ... mandatory for every task"

# Confirm result persistence documentation
grep -n "persist after" SKILL.md
# Expected: 1 hit in Monitor Progress section
```

End-to-end lifecycle trace (static -- no live session needed):

| Step | Verification |
|------|-------------|
| delegate | `grep -n "Steps 1-6" SKILL.md` shows full launch sequence |
| execute | `grep -n "claude -p" SKILL.md` shows launch command |
| crash | `grep -n "kill -0" scripts/monitor.sh` shows Layer 2 check |
| resume | `grep -n "claude -c" scripts/monitor.sh` shows resume dispatch |
| complete | `grep -n "touch.*done" SKILL.md` shows done-file written last |
| retrieve | `grep -n "output_tail\|tail -n 50" SKILL.md` shows both retrieval paths |
</verification>

<success_criteria>
Phase 5 is complete when:
1. `grep "long-running" SKILL.md` returns no match in the Health Monitoring section (D-2 SC1)
2. `grep "persist after the tmux session is killed" SKILL.md` returns 1 match (D-2 SC2)
3. Checklist step 9 contains no "or tail" alternative -- monitor launch is mandatory (D-2 SC1 + SC3)
4. All five verify assertions in Task 1 pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-brain-integration/05-01-SUMMARY.md` following the summary template at `@/Users/matt/.claude/get-shit-done/templates/summary.md`.
</output>
